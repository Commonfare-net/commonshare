<!DOCTYPE html>
<meta charset="utf-8">
<head>
<link rel="stylesheet" type="text/css" href="../css/commonfare.css">
<link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
<link href="https://fonts.googleapis.com/css?family=Dosis:800" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
<!--Bunches-->
    <div style="text-align:center;display:inline-block;width:auto;position:relative;margin:20px 30px 5px 30px;">
        <div class="bigchart border" id="bunchdiv" style="position:relative;border-radius: 50%;overflow: visible">
            <svg id="bunchlabels" width="210" height="210" style="position:absolute;top:-5px;right:-5px" ></svg>
            <svg id="bunches" width="200" height="200"  ></svg>
            <div id="bunchesdescription" style="display: flex;justify-content: center; align-items: center;text-align: center;position:absolute;width:100%;margin: auto auto; height: 75%; top:0;left: 0;pointer-events:none;font-family:'Dosis';font-size:16px">
            </div>
        </div>  
        <div class="datepicker" style="margin-top: -10px; line-height:100%">
            <i class="fa fa-arrow-left arrow" onclick="updateBunches(-1)"></i>
            <b id="bunchesdate" style="font-size:24px;font-family:Dosis"></b>
            <i class="fa fa-arrow-right arrow" onclick="updateBunches(1)"></i>
        </div>
    </div>
</body>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="../js/commonfuncs.js"></script>
<script src="../js/bunches.js"></script>

<script>
var infotooltip = d3.select("body").append("div")
	.attr("class", "tooltip")
	.style("opacity", 0);
var currentbunches = 0;
function updateBunches(value){
    if(value == -1)
        if(currentbunches == maxindex-1)return;
        else currentbunches++;
    else
        if(currentbunches == 0)return;
        else currentbunches --;
    plotbunches(graph_data[currentbunches]);
    $('#bunchesdate').text(getDateText(node_data[currentbunches]));
    
}
var maxindex = 0;
d3.json('../data/output/userdata/' + userid + '.json', function (results) {
	data = results;
	for (var fortnight in results) {
    	node_data[fortnight] = results[fortnight]['nodes'].find(findNode);
		node_data[fortnight].date = parseTime(node_data[fortnight].date);
		graph_data[fortnight] = results[fortnight];
        //This is necessary for D3 to map source and target indices to their respective nodes 
        plotbunches(graph_data[fortnight]);
        maxindex++;
	}
	plotbunches(graph_data[0]);
    $('#bunchesdate').text(getDateText(node_data[currentbunches]));

    
});
</script>
